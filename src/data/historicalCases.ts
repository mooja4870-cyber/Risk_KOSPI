export interface HistoricalCase {
  id: string;
  title: string;
  titleEn: string;
  market: string;
  period: string;
  peakValue: string;
  troughValue: string;
  decline: string;
  declinePercent: number;
  fiRole: string;
  mechanism: string[];
  timelineData: { month: string; index: number; fiFlow: number }[];
  keyLesson: string;
}

export const historicalCases: HistoricalCase[] = [
  {
    id: 'korea-2021',
    title: '2021 코스피 고점 → 2022 폭락',
    titleEn: 'KOSPI 2021 Peak → 2022 Crash',
    market: '한국 코스피',
    period: '2021.06 ~ 2022.10',
    peakValue: '3,316',
    troughValue: '2,155',
    decline: '-35%',
    declinePercent: 35,
    fiRole: '금융투자 순매도 전환이 고점 신호',
    mechanism: [
      '외국인 2021년 상반기부터 지속적 순매도',
      '개인투자자 매수 강도 약화',
      '금융투자가 지수 방어의 마지막 매수 주체',
      '2021.08 금융투자 순매도 전환',
      '매수 주체 완전 소멸 → 35% 하락',
    ],
    timelineData: [
      { month: '21.03', index: 3050, fiFlow: 1200 },
      { month: '21.04', index: 3150, fiFlow: 900 },
      { month: '21.05', index: 3200, fiFlow: 1100 },
      { month: '21.06', index: 3300, fiFlow: 800 },
      { month: '21.07', index: 3280, fiFlow: 200 },
      { month: '21.08', index: 3100, fiFlow: -500 },
      { month: '21.09', index: 3070, fiFlow: -800 },
      { month: '21.10', index: 2980, fiFlow: -1200 },
      { month: '21.11', index: 2930, fiFlow: -900 },
      { month: '21.12', index: 2900, fiFlow: -1100 },
      { month: '22.01', index: 2750, fiFlow: -1500 },
      { month: '22.03', index: 2700, fiFlow: -1800 },
      { month: '22.06', index: 2400, fiFlow: -2000 },
      { month: '22.10', index: 2155, fiFlow: -1200 },
    ],
    keyLesson: '금융투자가 순매수에서 순매도로 전환한 시점이 사실상 고점 신호였으며, 외국인과 개인이 이미 빠진 상태에서 금융투자마저 빠지니 매수 주체가 완전 소멸했다.',
  },
  {
    id: 'korea-2018',
    title: '2018 코스피 프로그램 매도 폭락',
    titleEn: 'KOSPI 2018 Program Selling Crash',
    market: '한국 코스피',
    period: '2018.01 ~ 2018.10',
    peakValue: '2,607',
    troughValue: '1,950',
    decline: '-25%',
    declinePercent: 25,
    fiRole: '차익거래 잔고 한꺼번에 청산',
    mechanism: [
      '반도체 슈퍼사이클 기대감으로 상승',
      '금융투자가 선물-현물 차익거래로 대규모 매수 누적',
      '2018.02 글로벌 변동성 쇼크(VIX 사태) 발생',
      '프로그램 매도 하루 수천억 원 출회',
      '코스피200 바스켓 전 종목 동시다발적 매도',
    ],
    timelineData: [
      { month: '17.09', index: 2380, fiFlow: 800 },
      { month: '17.10', index: 2480, fiFlow: 1000 },
      { month: '17.11', index: 2530, fiFlow: 1200 },
      { month: '17.12', index: 2560, fiFlow: 900 },
      { month: '18.01', index: 2607, fiFlow: 500 },
      { month: '18.02', index: 2400, fiFlow: -2500 },
      { month: '18.03', index: 2430, fiFlow: -1200 },
      { month: '18.04', index: 2450, fiFlow: -800 },
      { month: '18.06', index: 2300, fiFlow: -1500 },
      { month: '18.08', index: 2280, fiFlow: -900 },
      { month: '18.10', index: 1950, fiFlow: -2000 },
    ],
    keyLesson: '금융투자에 누적된 매수 차익 잔고가 외부 충격 한 방에 한꺼번에 청산되면서, 프로그램 매도가 연쇄적으로 발생했다.',
  },
  {
    id: 'korea-2008',
    title: '2008 한국 글로벌 금융위기',
    titleEn: 'Korea 2008 Global Financial Crisis',
    market: '한국 코스피',
    period: '2007.10 ~ 2008.10',
    peakValue: '2,085',
    troughValue: '892',
    decline: '-57%',
    declinePercent: 57,
    fiRole: '차익거래 잔고 일시 청산 + 강제 매도',
    mechanism: [
      '2007년 코스피 2,000 돌파 시 프로그램 매수 기여',
      '리먼브라더스 파산 이후 차익거래 잔고 일시 청산',
      '선물 급락 → 베이시스 역전 → 프로그램 매도 트리거',
      '증권사 리스크관리 규정에 의한 자동 청산',
      '선물 마진콜 → 현물 처분으로 자금 조달',
    ],
    timelineData: [
      { month: '07.06', index: 1800, fiFlow: 600 },
      { month: '07.08', index: 1900, fiFlow: 800 },
      { month: '07.10', index: 2085, fiFlow: 400 },
      { month: '07.12', index: 1950, fiFlow: -200 },
      { month: '08.01', index: 1800, fiFlow: -1500 },
      { month: '08.03', index: 1650, fiFlow: -2000 },
      { month: '08.05', index: 1800, fiFlow: -500 },
      { month: '08.07', index: 1550, fiFlow: -1800 },
      { month: '08.09', index: 1400, fiFlow: -3000 },
      { month: '08.10', index: 892, fiFlow: -4000 },
    ],
    keyLesson: '금융투자의 강제 매도(Forced Selling) 메커니즘: 손실 한도 초과 → 자동 청산, 선물 마진콜 → 현물 처분, 환매 요청 → 펀드 보유 주식 처분의 악순환.',
  },
  {
    id: 'us-1987',
    title: '1987 블랙 먼데이',
    titleEn: '1987 Black Monday',
    market: '미국 다우존스',
    period: '1987.10.19',
    peakValue: '2,722',
    troughValue: '1,738',
    decline: '-36%',
    declinePercent: 36,
    fiRole: '포트폴리오 보험 기계적 매도',
    mechanism: [
      '다우존스 연초 대비 44% 상승',
      '포트폴리오 보험(Portfolio Insurance) 전략 유행',
      '주가 하락 시 자동 선물 매도 발동',
      '선물 급락 → 현물 괴리 → 차익거래 현물 매도',
      '하루 -22.6% 역사상 최대 일일 하락',
    ],
    timelineData: [
      { month: '87.06', index: 2400, fiFlow: 500 },
      { month: '87.07', index: 2550, fiFlow: 600 },
      { month: '87.08', index: 2722, fiFlow: 300 },
      { month: '87.09', index: 2600, fiFlow: -200 },
      { month: '87.10', index: 1738, fiFlow: -5000 },
      { month: '87.11', index: 1850, fiFlow: -1000 },
      { month: '87.12', index: 1950, fiFlow: 200 },
    ],
    keyLesson: '"소수의 기관투자자가 사용한 기계적 매도 전략이 시장 전체를 붕괴시켰다" — Brady Commission 결론',
  },
  {
    id: 'us-2008',
    title: '2008 리먼 브라더스 위기',
    titleEn: '2008 Lehman Brothers Crisis',
    market: '미국 S&P 500',
    period: '2007.10 ~ 2009.03',
    peakValue: '1,576',
    troughValue: '666',
    decline: '-58%',
    declinePercent: 58,
    fiRole: '투자은행 레버리지 청산',
    mechanism: [
      '투자은행들 MBS/CDO 자기자본 30~40배 레버리지 보유',
      '시장에서 가장 큰 매수자이자 보유자',
      '주택가격 하락 → 보유자산 가치 하락',
      '마진콜 → 강제 매도 → 가격 추가 하락',
      '시스템적 위기로 확대',
    ],
    timelineData: [
      { month: '07.06', index: 1500, fiFlow: 400 },
      { month: '07.10', index: 1576, fiFlow: 100 },
      { month: '08.01', index: 1400, fiFlow: -800 },
      { month: '08.03', index: 1300, fiFlow: -1500 },
      { month: '08.06', index: 1280, fiFlow: -1000 },
      { month: '08.09', index: 1100, fiFlow: -4000 },
      { month: '08.11', index: 800, fiFlow: -3500 },
      { month: '09.01', index: 850, fiFlow: -2000 },
      { month: '09.03', index: 666, fiFlow: -1500 },
    ],
    keyLesson: '시장의 최대 매수 주체가 레버리지를 쓰는 단기 자금일 때, 그들의 이탈은 단순한 조정이 아닌 시스템적 위기로 발전한다.',
  },
  {
    id: 'china-2015',
    title: '2015 중국 주식시장 폭락',
    titleEn: '2015 China Stock Market Crash',
    market: '중국 상해종합',
    period: '2015.06 ~ 2015.08',
    peakValue: '5,178',
    troughValue: '2,850',
    decline: '-45%',
    declinePercent: 45,
    fiRole: '증권사 마진콜 + 자기매매 청산',
    mechanism: [
      '증권사 신용융자로 개인에게 돈을 빌려주며 상승 주도',
      '증권사 자체도 자기매매로 대규모 주식 보유',
      '마진콜 발생 → 개인 강제 청산',
      '증권사 리스크 한도 초과 → 자기매매 포지션 청산',
      '정부 매도 금지령 + 국가대표팀 매수로 간신히 저지',
    ],
    timelineData: [
      { month: '14.12', index: 3200, fiFlow: 2000 },
      { month: '15.02', index: 3400, fiFlow: 2500 },
      { month: '15.04', index: 4500, fiFlow: 3000 },
      { month: '15.06', index: 5178, fiFlow: 1000 },
      { month: '15.06W3', index: 4500, fiFlow: -3000 },
      { month: '15.06W4', index: 4000, fiFlow: -4000 },
      { month: '15.07W1', index: 3500, fiFlow: -5000 },
      { month: '15.07W3', index: 3200, fiFlow: -2000 },
      { month: '15.08', index: 2850, fiFlow: -3000 },
    ],
    keyLesson: '증권사가 상승의 핵심 매수 주체였을 때, 매도 전환은 마진콜 연쇄를 통해 폭락을 촉발. 정부의 매도 금지령으로 간신히 저지.',
  },
  {
    id: 'us-2010',
    title: '2010 플래시 크래시',
    titleEn: '2010 Flash Crash',
    market: '미국 다우존스',
    period: '2010.05.06',
    peakValue: '-',
    troughValue: '-',
    decline: '-9.2%(일간)',
    declinePercent: 9.2,
    fiRole: '마켓메이커 유동성 철수',
    mechanism: [
      'HFT/Market Maker가 유동성 대부분 공급',
      '대형 기관의 E-mini S&P 500 대량 매도',
      'HFT/Market Maker 동시 호가 철회',
      '매수 호가 순간적으로 완전 소멸',
      '6분 만에 다우존스 약 1,000포인트 급락',
    ],
    timelineData: [
      { month: '14:30', index: 10400, fiFlow: 200 },
      { month: '14:40', index: 10300, fiFlow: -500 },
      { month: '14:42', index: 10100, fiFlow: -2000 },
      { month: '14:45', index: 9800, fiFlow: -5000 },
      { month: '14:47', index: 9500, fiFlow: -8000 },
      { month: '14:50', index: 10200, fiFlow: 3000 },
      { month: '15:00', index: 10400, fiFlow: 1000 },
    ],
    keyLesson: '금융투자(딜러/마켓메이커)가 매수의 마지막 보루일 때, 이들이 빠지는 순간 시장에는 매수자가 0명이 되는 극단적 유동성 공백이 발생한다.',
  },
  {
    id: 'us-2018',
    title: '2018 볼마겟돈',
    titleEn: '2018 Volmageddon',
    market: '미국 S&P 500',
    period: '2018.02.05',
    peakValue: '-',
    troughValue: '-',
    decline: '-10%',
    declinePercent: 10,
    fiRole: 'Short Volatility 전략 일시 청산',
    mechanism: [
      '금융기관/ETF가 변동성 매도(Short Vol) 전략 운용',
      '낮은 변동성 환경에서 매수 압력 제공',
      '변동성 급상승 시 모든 Short Vol 포지션 동시 청산',
      'VIX 하루 +116% 급등',
      'XIV(인버스 VIX ETN) -96% → 사실상 소멸',
    ],
    timelineData: [
      { month: '18.01', index: 2870, fiFlow: 500 },
      { month: '18.01W4', index: 2850, fiFlow: 200 },
      { month: '18.02.02', index: 2760, fiFlow: -1500 },
      { month: '18.02.05', index: 2580, fiFlow: -5000 },
      { month: '18.02.08', index: 2580, fiFlow: -2000 },
      { month: '18.02.12', index: 2650, fiFlow: 500 },
    ],
    keyLesson: '기계적 매도 전략이 시장에 누적되면, 트리거 발동 시 동시 청산으로 인해 폭발적 매도가 발생한다.',
  },
];

export interface SellingStreak {
  start: string;
  end: string;
  days: number;
  totalSold: number;
  kospiChange: number;
  isHistorical?: boolean;
}

export const significantHistoricalStreaks: SellingStreak[] = [
  { start: '2021-08-09', end: '2021-08-20', days: 10, totalSold: -78450, kospiChange: -205.42, isHistorical: true },
  { start: '2018-02-01', end: '2018-02-09', days: 7, totalSold: -42500, kospiChange: -245.10, isHistorical: true },
  { start: '2008-09-16', end: '2008-10-02', days: 12, totalSold: -92400, kospiChange: -412.30, isHistorical: true },
  { start: '2024-01-02', end: '2024-01-17', days: 11, totalSold: -62100, kospiChange: -234.15, isHistorical: true },
  { start: '2022-06-03', end: '2022-06-17', days: 9, totalSold: -38200, kospiChange: -188.50, isHistorical: true },
  { start: '2011-08-02', end: '2011-08-12', days: 9, totalSold: -45600, kospiChange: -350.20, isHistorical: true },
  { start: '2004-04-26', end: '2004-05-17', days: 15, totalSold: -52000, kospiChange: -120.40, isHistorical: true },
];

export const riskThresholds = {
  level1: {
    name: '안정',
    consecutiveDays: '0-2일',
    sellRatio: '0-10%',
    description: '금융투자 매수 유지 또는 소규모 매도',
    historicalOutcome: '정상적 시장 변동 범위',
    color: '#10B981',
  },
  level2: {
    name: '관심',
    consecutiveDays: '3-4일',
    sellRatio: '10-20%',
    description: '일부 매도 움직임 감지',
    historicalOutcome: '단기 조정 가능성 (3-5% 하락)',
    color: '#3B82F6',
  },
  level3: {
    name: '주의',
    consecutiveDays: '5-6일',
    sellRatio: '20-30%',
    description: '금융투자 매도 전환 신호',
    historicalOutcome: '중기 조정 가능성 (5-10% 하락)',
    color: '#F59E0B',
  },
  level4: {
    name: '높은 위험',
    consecutiveDays: '7-9일',
    sellRatio: '30-40%',
    description: '금융투자 매도 강도 증가',
    historicalOutcome: '급락 가능성 (10-25% 하락)',
    color: '#EA580C',
  },
  level5: {
    name: '극심한 위험',
    consecutiveDays: '10일 이상',
    sellRatio: '40% 이상',
    description: '대규모 연속 매도, 폭락 패턴',
    historicalOutcome: '폭락 가능성 (25% 이상 하락)',
    color: '#DC2626',
  },
};
